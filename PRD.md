# **智能AI助手产品需求文档 (PRD) - v2.0 (Evolving Persona)**

| **文档版本** | **V1.1** | **创建日期** | 2025年6月11日 | **创建者** | Gemini |
| :--- | :--- | :--- | :--- | :--- | :--- |
| **审阅人** | 872226263 | **审阅日期** | | | |

## 1. 产品概述 (Product Overview)

### 1.1. 产品愿景 (Vision)
打造一个可成长的、具备独特个性与长期记忆的、真正意义上的个性化AI伴侣。它不仅仅是一个问答工具，更是一个能与用户共同经历、共同成长，并在此过程中形成独一无二"灵魂"的智能生命体。

### 1.2. 核心理念 (Core Philosophy)
**从"被动塑造"到"自然演化"**。摒弃传统由用户通过指令直接"设定"AI性格的模式。v2.0的核心是，AI的人格将完全通过分析与用户的长期对话历史，进行无感的、持续的、自然的演化，最终形成一个高度复杂和独特的个性。

## 2. 系统架构 (System Architecture)

为了实现上述功能，我们设计了如下微服务架构：

v2.1版本将引入**"双视界主动式智能体" (Dual-Horizon Proactive Agent)** 架构。该架构包含一个低功耗的、部署在用户本地的"哨兵模型"（Sentinel Model），用于7x24小时持续感知用户环境（如日历、待办事项、新闻）；以及一个高性能的、部署在云端的"执行者模型"（Executor Model），用于在哨兵模型触发后，执行高质量的、个性化的、主动的交互。这使得AI能够从被动响应进化为主动辅助。

```mermaid
graph TD
    subgraph "客户端"
        User[用户]
    end

    subgraph "后端服务"
        User -- HTTPS/WSS --> Gateway[API Gateway];
        
        Gateway -- gRPC/REST --> ChatSvc[Chat Service];
        
        ChatSvc --> LLMSvc[LLM Service];
        ChatSvc --> MemSvc[Memory Service];
        ChatSvc --> PersSvc[Persona Service];

        LLMSvc -- API --> LLM_API[外部LLM API];
        MemSvc -- CRUD --> VecDB[(Vector DB)];
        PersSvc -- CRUD --> PersDB[(Persona DB)];
    end

    subgraph "数据流: /chat 请求"
        direction LR
        A[1. 用户消息] --> B{2. Chat Service};
        B --> C{3. Memory Service<br>检索相关记忆摘要};
        B --> D{4. Persona Service<br>获取当前30小面人格状态};
        C & D --> E{5. Chat Service<br>构建对话Prompt};
        E --> F{6. LLM Service<br>生成回答};
        F --> G{7. Chat Service<br>返回回答给用户};
        G --> H[8. 用户接收];
        G -- 异步触发 --> I{9. **人格演化引擎<br>(Persona Evolution Engine)**};
        I --> J{10. 分析对话<br>计算人格增量};
        J --> K{11. Persona Service<br>更新并持久化人格状态};
    end
```

- **Chat Service**: 负责核心的对话流程编排。
- **Persona Service**: 内部包含**人格演化引擎 (Persona Evolution Engine)**，负责计算和更新人格状态。
- **Memory Service**: 负责长期记忆的存储和检索。
- **Persona DB (SQLite)**: 这是一个轻量级的**嵌入式数据库 (`.db` 文件)**，用于存储结构化的人格数据。它的"无服务"特性使整个系统非常易于在个人设备上部署和迁移。
- **Vector DB (Qdrant)**: 高性能向量数据库，用于存储对话的语义记忆。

我们选择Qdrant作为向量数据库，因为它性能优越，并且支持丰富的元数据过滤，这对于未来实现更复杂的记忆检索逻辑至关重要。

## 3. 功能需求 (Functional Requirements)

| ID | 功能名称 | 描述 |
| :--- | :--- | :--- |
| **FR-01**| 核心对话 | 用户可以与AI进行流畅的多轮对话。 |
| **FR-02**| 长期记忆 | AI能记住过去的对话内容，并在后续交流中主动或被动地引用。 |
| **FR-03**| **人格的无感演化** | AI的人格将完全通过分析与用户的长期对话历史，进行无感的、自然的演化。用户的每一句话，都在潜移默化地影响AI的性格发展。|
| **FR-04**| **核心身份设定** | 用户可以为AI设定`名字`等少数基本身份信息。所有复杂的性格特质都由系统演化生成。 |
| **FR-05**| 记忆召回 | 在对话中，AI能根据上下文，自动从记忆库中检索最相关的信息。|
| **FR-06**| Reranker精排 | 使用Reranker模型对召回的记忆进行二次排序，确保上下文的精准性。 |
| **FR-07**| **In-Character回答**| AI的回答风格、语气、观点，都应精准地反映其内部**30个细分人格小面**所定义的复杂性格。|
| **FR-08**| 对话历史查看 | 用户可以查看与AI的完整聊天记录。 |
| **FR-09**| 多模态输入 (V2) | 支持图片、语音等非文本格式的输入。 |
| **FR-10**| **人格观察报告** | 提供一个**只读的**、可视化的界面，让用户可以观察AI基于"大五人格"30个小面的详细人格画像，例如通过雷达图的形式。 |
| **FR-11**| **重置功能** | 用户可以选择清空AI的所有记忆和人格，从零开始重新培养。 |
| **FR-12**| **主动式辅助 (Proactive Assistance)** | AI将不再仅仅被动响应，而是能够根据对用户日程、待办事项和相关新闻的持续感知，在合适的时机主动发起有价值的对话，提供前瞻性的提醒和帮助。 |

## 4. 非功能需求 (Non-Functional Requirements)

| ID | 需求名称 | 描述与KPI |
| :--- | :--- | :--- |
| **NFR-01**| 性能 | P95响应延迟 < 1.5秒；支持至少50 QPS的并发请求。|
| **NFR-02**| 可用性 | 系统整体可用性 > 99.9%。 |
| **NFR-03**| 数据安全 | 用户数据、对话历史需加密存储，符合行业安全标准。 |
| **NFR-04**| **人格一致性** | **KPI**: AI的行为应与其通过对话演化出的、**基于30个小面的人格模型**高度一致。<br>**验收标准**: 在细粒度人格探测测试中，一致性得分 > 85%。 |

## 5. 产品路线图 (Roadmap)

### Phase 1: MVP - Evolving Persona Engine (6周)
- **核心目标**: 上线v1版**人格演化引擎**，让用户能体验到AI在对话中真实、自然地形成独特个性的核心链路。
- **主要功能**:
  - `FR-01` 核心对话
  - `FR-02` 长期记忆 (基于向量数据库)
  - `FR-03` **人格的无感演化 (核心)**
  - `FR-04` 核心身份设定 (仅名字)
  - `FR-05`/`FR-06` 记忆召回与精排
  - `FR-07` In-Character回答 (基于30小面)
  - `FR-08` 对话历史查看
  - `FR-10` **人格观察报告v1 (雷达图可视化)**
  - `FR-11` 重置功能

### Phase 2: V2 - Richer Interaction & Insight (Q3)
- **核心目标**: 丰富交互维度，并为用户提供更深度的成长洞察。
- **主要功能**:
  - `FR-09` 多模态输入 (支持图片理解)
  - 在`FR-10`人格观察报告中增加"**成长轨迹**"可视化功能，允许用户回顾关键人格小面的历史变化。
  - 引入更主动的AI行为（如基于人格主动发起话题）。
  - 优化人格演化算法，提高对复杂语境（如反讽）的理解力。

### Phase 3: V3 - Proactive Companion (Q4)
- **核心目标**: 使AI从一个被动的对话者，转变为一个能主动关心用户、参与用户生活的智能伴侣。
- **主要功能**:
  - 主动问候与关怀。
  - 对用户日程、待办事项的感知与提醒。
  - 与第三方应用（如日历、音乐App）的联动能力。

## 6. 衡量指标 (KPIs)

我们将从以下五个维度来综合评估系统的成功：

1.  **用户参与度 (User Engagement)**
    *   **DAU/MAU**: 日/月活跃用户数。
    *   **核心交互频率**: 用户与AI进行对话的平均频率。

2.  **用户留存率 (User Retention)**
    *   **次日、7日、30日留存率**: 衡量产品的长期吸引力。

3.  **主动智能质量 (Proactive Intelligence Quality)**
    *   **主动交互采纳率**: `用户响应的AI主动对话次数 / AI发起的总主动对话次数`。此指标衡量AI主动行为的相关性和时机准确性。
    *   **主动辅助满意度**: 通过交互后UI上的 `👍/👎` 按钮收集。此指标衡量AI主动帮助的实际价值。
    *   **功能留存率**: `(启用主动式辅助功能的用户数) / (总用户数)`。此指标宏观判断主动式功能本身的成败。

4.  **人格与内部一致性 (Persona & Internal Coherence)**
    *   **NPS 用户满意度**: 通过NPS评分或用户访谈，评估用户对AI"个性"的整体满意度和"养成感"。
    *   **人工评估一致性**: 通过抽样人工评估，判断AI的回答是否符合其展现的人格画像。
    *   **记忆扎根度 (Memory Groundedness Score)**: 通过计算AI回答向量与其引用的记忆向量之间的平均余弦相似度得出。此为自动化客观指标，用于量化回答的"有据可循"程度，并可作为幻觉检测的代理指标。

5.  **内部工程与成本指标 (Internal-Facing)**
    *   **哨兵触发准确率**: `被"执行者"采纳的MCP包数量 / "哨兵"上报的总MCP包数量`。此指标用于监控和优化云端高算力模型的调用成本。
